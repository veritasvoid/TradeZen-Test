import{u as w,a as m}from"./useMutation-DTDEvqP6.js";import{f as h,h as I,S as f,i as N}from"./index-Dej5AtVC.js";const p=6e4,T=36e5;function y(e,t){const n=v(e);let r;if(n.date){const i=E(n.date,2);r=R(i.restDateString,i.year)}if(!r||isNaN(r.getTime()))return new Date(NaN);const o=r.getTime();let a=0,u;if(n.time&&(a=Y(n.time),isNaN(a)))return new Date(NaN);if(n.timezone){if(u=x(n.timezone),isNaN(u))return new Date(NaN)}else{const i=new Date(o+a),c=new Date(0);return c.setFullYear(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()),c.setHours(i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds()),c}return new Date(o+a+u)}const d={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},C=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,S=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,U=/^([+-])(\d{2})(?::?(\d{2}))?$/;function v(e){const t={},s=e.split(d.dateTimeDelimiter);let n;if(s.length>2)return t;if(/:/.test(s[0])?n=s[0]:(t.date=s[0],n=s[1],d.timeZoneDelimiter.test(t.date)&&(t.date=e.split(d.timeZoneDelimiter)[0],n=e.substr(t.date.length,e.length))),n){const r=d.timezone.exec(n);r?(t.time=n.replace(r[1],""),t.timezone=r[1]):t.time=n}return t}function E(e,t){const s=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=e.match(s);if(!n)return{year:NaN,restDateString:""};const r=n[1]?parseInt(n[1]):null,o=n[2]?parseInt(n[2]):null;return{year:o===null?r:o*100,restDateString:e.slice((n[1]||n[2]).length)}}function R(e,t){if(t===null)return new Date(NaN);const s=e.match(C);if(!s)return new Date(NaN);const n=!!s[4],r=l(s[1]),o=l(s[2])-1,a=l(s[3]),u=l(s[4]),i=l(s[5])-1;if(n)return W(t,u,i)?A(t,u,i):new Date(NaN);{const c=new Date(0);return!M(t,o,a)||!O(t,r)?new Date(NaN):(c.setUTCFullYear(t,o,Math.max(r,a)),c)}}function l(e){return e?parseInt(e):1}function Y(e){const t=e.match(S);if(!t)return NaN;const s=g(t[1]),n=g(t[2]),r=g(t[3]);return z(s,n,r)?s*T+n*p+r*1e3:NaN}function g(e){return e&&parseFloat(e.replace(",","."))||0}function x(e){if(e==="Z")return 0;const t=e.match(U);if(!t)return 0;const s=t[1]==="+"?-1:1,n=parseInt(t[2]),r=t[3]&&parseInt(t[3])||0;return $(n,r)?s*(n*T+r*p):NaN}function A(e,t,s){const n=new Date(0);n.setUTCFullYear(e,0,4);const r=n.getUTCDay()||7,o=(t-1)*7+s+1-r;return n.setUTCDate(n.getUTCDate()+o),n}const F=[31,null,31,30,31,30,31,31,30,31,30,31];function D(e){return e%400===0||e%4===0&&e%100!==0}function M(e,t,s){return t>=0&&t<=11&&s>=1&&s<=(F[t]||(D(e)?29:28))}function O(e,t){return t>=1&&t<=(D(e)?366:365)}function W(e,t,s){return t>=1&&t<=53&&s>=0&&s<=6}function z(e,t,s){return e===24?t===0&&s===0:s>=0&&s<60&&t>=0&&t<60&&e>=0&&e<25}function $(e,t){return t>=0&&t<=59}const q=(e,t)=>{const s=e+t;return s===0?0:Math.round(e/s*100)},L=e=>{if(!e||e.length===0)return{totalPL:0,tradeCount:0,winCount:0,lossCount:0,winRate:0,avgWin:0,avgLoss:0};const t=e.reduce((a,u)=>a+u.amount,0),s=e.filter(a=>a.amount>0),n=e.filter(a=>a.amount<0),r=s.length>0?s.reduce((a,u)=>a+u.amount,0)/s.length:0,o=n.length>0?n.reduce((a,u)=>a+Math.abs(u.amount),0)/n.length:0;return{totalPL:t,tradeCount:e.length,winCount:s.length,lossCount:n.length,winRate:q(s.length,n.length),avgWin:r,avgLoss:o}},K=(e,t)=>Array.from({length:12},(n,r)=>r).map(n=>{const r=e.filter(o=>{const a=y(o.date);return a.getFullYear()===t&&a.getMonth()===n});return{month:n,...L(r)}}),P=()=>crypto.randomUUID(),Z=e=>!e||e.length<5?null:{tagId:e[0],name:e[1],color:e[2],emoji:e[3],order:parseInt(e[4])||0},_=async()=>{const e="1ruzm5D-ofifAU7d5oRChBT7DAYFTlVLgULSsXvYEtXU";console.log("ðŸ·ï¸ Fetching tags from sheet:",e);try{const s=(await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:e,range:`${f.TAGS}!A2:E`})).result.values||[];console.log("ðŸ“¥ Received tag rows:",s.length);const n=s.map(Z).filter(Boolean);return console.log("âœ… Parsed tags:",n),n.sort((r,o)=>r.order-o.order)}catch(t){return console.error("âŒ Failed to fetch tags:",t),[]}},k=async e=>{const t=await I.getOrCreateSpreadsheet(),s=[e.tagId,e.name,e.color,e.emoji,e.order||0];return await window.gapi.client.sheets.spreadsheets.values.append({spreadsheetId:t,range:`${f.TAGS}!A:E`,valueInputOption:"USER_ENTERED",resource:{values:[s]}}),e},H=async e=>{const t=localStorage.getItem(N.SHEET_ID),r=((await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:t,range:`${f.TAGS}!A:A`})).result.values||[]).findIndex(o=>o[0]===e);if(r===-1)throw new Error("Tag not found");await window.gapi.client.sheets.spreadsheets.batchUpdate({spreadsheetId:t,resource:{requests:[{deleteDimension:{range:{sheetId:1,dimension:"ROWS",startIndex:r,endIndex:r+1}}}]}})},Q=()=>w({queryKey:["tags"],queryFn:_,staleTime:0,gcTime:0,refetchOnMount:"always"}),j=()=>{const e=h();return m({mutationFn:k,onSuccess:()=>{e.invalidateQueries({queryKey:["tags"]})}})},B=()=>{const e=h();return m({mutationFn:H,onSuccess:()=>{e.invalidateQueries({queryKey:["tags"]})}})};export{j as a,B as b,K as c,P as g,Q as u};
