import{d as F,b as O,r as f,j as e,T as R,X as q}from"./index-sUMg8Cai.js";import{a as z,b as W}from"./useTrades-DGgfOXt3.js";import{u as J,f as j,g as Y}from"./useTags-DMom4j-j.js";import{u as B}from"./settingsStore-CshmIZrJ.js";const K=()=>{const{year:m,month:n}=F(),a=O(),s=new Date,i=parseInt(m)||s.getFullYear(),l=n!==void 0?parseInt(n):s.getMonth(),{data:o=[],isLoading:g}=z(i,l),{data:r=[]}=J(),d=B(t=>t.settings.currency),[h,x]=f.useState(!1),[k,D]=f.useState(null),I=t=>{const c=`${i}-${String(l+1).padStart(2,"0")}-${String(t).padStart(2,"0")}`;D(c),x(!0)},T=["January","February","March","April","May","June","July","August","September","October","November","December"],C=new Date(i,l+1,0).getDate(),M=new Date(i,l,1).getDay(),v=o.reduce((t,c)=>t+c.amount,0),N=o.filter(t=>t.amount>0),L=o.filter(t=>t.amount<0),y=o.length>0?Math.round(N.length/o.length*100):0,w=_(o),p={};return o.forEach(t=>{const c=parseInt(t.date.split("-")[2]);p[c]||(p[c]=[]),p[c].push(t)}),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950",style:{paddingTop:"80px"},children:[e.jsx("div",{className:"border-b border-slate-700/50 bg-slate-900/50 backdrop-blur-sm px-6 py-4",children:e.jsxs("div",{className:"max-w-[1800px] mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>a("/"),className:"flex items-center gap-3 hover:opacity-80 transition-opacity",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-purple-600 p-2 rounded-xl",children:e.jsx(R,{size:24,className:"text-white"})}),e.jsx("span",{className:"text-2xl font-black bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:"TradeZen"})]}),e.jsxs("h1",{className:"text-2xl font-black",children:[T[l]," ",i]}),e.jsx("button",{className:"w-10 h-10"})," "]})}),e.jsx("div",{className:"max-w-[1800px] mx-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-9",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-sm rounded-2xl border border-slate-700/50 p-6",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:"text-center text-slate-400 text-sm font-semibold py-2",children:t},t))}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[Array.from({length:M}).map((t,c)=>e.jsx("div",{className:"aspect-square"},`empty-${c}`)),Array.from({length:C}).map((t,c)=>{const u=c+1,S=p[u]||[],P=S.reduce(($,E)=>$+E.amount,0),A=u===s.getDate()&&l===s.getMonth()&&i===s.getFullYear();return e.jsx(U,{day:u,trades:S,dayPL:P,isToday:A,currency:d,onClick:()=>I(u)},u)})]})]})}),e.jsxs("div",{className:"col-span-3 space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-sm rounded-2xl border border-slate-700/50 p-6",children:[e.jsx("h3",{className:"text-sm uppercase tracking-wider text-slate-400 mb-4 font-semibold text-center",children:"Month Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{label:"Total P&L",value:j(v,d),color:v>=0?"emerald":"red"}),e.jsx(b,{label:"Trades",value:o.length}),e.jsx(b,{label:"Winners",value:N.length,color:"emerald"}),e.jsx(b,{label:"Losers",value:L.length,color:"red"}),e.jsx(b,{label:"Win Rate",value:`${y}%`,color:y>=50?"emerald":"red"})]})]}),w.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-sm rounded-2xl border border-slate-700/50 p-6",children:[e.jsx("h3",{className:"text-sm uppercase tracking-wider text-slate-400 mb-4 font-semibold text-center",children:"Strategies"}),e.jsx("div",{className:"space-y-3",children:w.map(t=>e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xl",children:t.tagEmoji}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-xs font-bold truncate",style:{color:t.tagColor},children:t.tagName})})]}),e.jsx("div",{className:`text-lg font-black ${t.totalPL>=0?"text-emerald-400":"text-red-400"}`,children:j(t.totalPL,d)}),e.jsxs("div",{className:"text-[10px] text-slate-400 mt-1",children:[t.trades,"T â€¢ ",t.winRate,"% WR"]})]},t.tagId))})]})]})]})}),h&&e.jsx(V,{date:k,tags:r,currency:d,onClose:()=>x(!1)})]})},U=({day:m,trades:n,dayPL:a,isToday:s,currency:i,onClick:l})=>{const o=n.length>0,g=o?a>0?"bg-emerald-900/20 border-emerald-500/30":"bg-red-900/20 border-red-500/30":"bg-slate-800/20 border-slate-700/30";return e.jsxs("div",{onClick:l,className:`aspect-square rounded-lg border ${g} ${s?"ring-2 ring-blue-500":""} p-2 relative hover:bg-slate-700/30 transition-all cursor-pointer`,children:[e.jsx("div",{className:"text-sm font-semibold text-slate-300",children:m}),o&&e.jsx("div",{className:`text-xs font-bold mt-1 ${a>=0?"text-emerald-400":"text-red-400"}`,children:j(a,i)}),o&&e.jsx("div",{className:"absolute bottom-1 left-1 flex flex-wrap gap-1",children:[...new Set(n.map(r=>r.tagName).filter(Boolean))].map(r=>e.jsx("span",{className:"text-[8px] text-slate-400 bg-slate-900/50 px-1 rounded",children:r},r))}),n.length>1&&e.jsx("div",{className:"absolute bottom-1 right-1 text-[9px] text-slate-500 font-semibold",children:n.length})]})},b=({label:m,value:n,color:a})=>{const s=a==="emerald"?"text-emerald-400":a==="red"?"text-red-400":"text-white";return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-slate-400 uppercase tracking-wider",children:m}),e.jsx("span",{className:`text-lg font-black ${s}`,children:n})]})},_=m=>{const n={};return m.forEach(a=>{const s=a.tagId||"none";s!=="none"&&(n[s]||(n[s]={tagId:s,tagName:a.tagName,tagColor:a.tagColor,tagEmoji:a.tagEmoji,totalPL:0,trades:0,wins:0}),n[s].totalPL+=a.amount,n[s].trades+=1,a.amount>0&&(n[s].wins+=1))}),Object.values(n).map(a=>({...a,winRate:a.trades>0?Math.round(a.wins/a.trades*100):0})).sort((a,s)=>s.totalPL-a.totalPL)},V=({date:m,tags:n,currency:a,onClose:s})=>{const i=W(),[l,o]=f.useState({amount:"",time:new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"}),tagId:"",notes:""}),g=async r=>{r.preventDefault();const d=n.find(x=>x.tagId===l.tagId),h={tradeId:Y(),date:m,time:l.time,amount:parseFloat(l.amount),tagId:l.tagId||null,tagName:(d==null?void 0:d.name)||null,tagColor:(d==null?void 0:d.color)||null,tagEmoji:(d==null?void 0:d.emoji)||null,driveImageId:null,notes:l.notes,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{await i.mutateAsync(h),s()}catch(x){alert("Failed to save trade: "+x.message)}};return e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-900 rounded-2xl border border-slate-700 max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-black",children:"New Trade"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-slate-800 rounded-lg transition-all",children:e.jsx(q,{size:20})})]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-400 mb-2",children:"Date"}),e.jsx("input",{type:"text",value:m,readOnly:!0,className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-slate-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-400 mb-2",children:"Time"}),e.jsx("input",{type:"time",value:l.time,onChange:r=>o({...l,time:r.target.value}),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 focus:border-blue-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-400 mb-2",children:["P&L Amount (",a,")"]}),e.jsx("input",{type:"number",step:"0.01",value:l.amount,onChange:r=>o({...l,amount:r.target.value}),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 focus:border-blue-500 focus:outline-none",placeholder:"e.g., 100 or -50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-400 mb-2",children:"Strategy Tag"}),e.jsxs("select",{value:l.tagId,onChange:r=>o({...l,tagId:r.target.value}),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"No Tag"}),n.map(r=>e.jsxs("option",{value:r.tagId,children:[r.emoji," ",r.name]},r.tagId))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-400 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{value:l.notes,onChange:r=>o({...l,notes:r.target.value}),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 focus:border-blue-500 focus:outline-none resize-none",rows:3,placeholder:"Add notes about this trade..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-3 bg-slate-800 hover:bg-slate-700 rounded-lg transition-all font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:i.isLoading,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:shadow-lg rounded-lg transition-all font-semibold disabled:opacity-50",children:i.isLoading?"Saving...":"Save Trade"})]})]})]})})};export{K as default};
