import{u as w,a as m}from"./useMutation-Cg24QtMB.js";import{f as p,h as I,S as f,i as y}from"./index-bno3-3QJ.js";const h=6e4,T=36e5;function N(e,t){const s=v(e);let r;if(s.date){const i=x(s.date,2);r=E(i.restDateString,i.year)}if(!r||isNaN(r.getTime()))return new Date(NaN);const o=r.getTime();let a=0,c;if(s.time&&(a=F(s.time),isNaN(a)))return new Date(NaN);if(s.timezone){if(c=R(s.timezone),isNaN(c))return new Date(NaN)}else{const i=new Date(o+a),u=new Date(0);return u.setFullYear(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()),u.setHours(i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds()),u}return new Date(o+a+c)}const d={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},C=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,S=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,U=/^([+-])(\d{2})(?::?(\d{2}))?$/;function v(e){const t={},n=e.split(d.dateTimeDelimiter);let s;if(n.length>2)return t;if(/:/.test(n[0])?s=n[0]:(t.date=n[0],s=n[1],d.timeZoneDelimiter.test(t.date)&&(t.date=e.split(d.timeZoneDelimiter)[0],s=e.substr(t.date.length,e.length))),s){const r=d.timezone.exec(s);r?(t.time=s.replace(r[1],""),t.timezone=r[1]):t.time=s}return t}function x(e,t){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=e.match(n);if(!s)return{year:NaN,restDateString:""};const r=s[1]?parseInt(s[1]):null,o=s[2]?parseInt(s[2]):null;return{year:o===null?r:o*100,restDateString:e.slice((s[1]||s[2]).length)}}function E(e,t){if(t===null)return new Date(NaN);const n=e.match(C);if(!n)return new Date(NaN);const s=!!n[4],r=l(n[1]),o=l(n[2])-1,a=l(n[3]),c=l(n[4]),i=l(n[5])-1;if(s)return O(t,c,i)?A(t,c,i):new Date(NaN);{const u=new Date(0);return!Y(t,o,a)||!$(t,r)?new Date(NaN):(u.setUTCFullYear(t,o,Math.max(r,a)),u)}}function l(e){return e?parseInt(e):1}function F(e){const t=e.match(S);if(!t)return NaN;const n=g(t[1]),s=g(t[2]),r=g(t[3]);return W(n,s,r)?n*T+s*h+r*1e3:NaN}function g(e){return e&&parseFloat(e.replace(",","."))||0}function R(e){if(e==="Z")return 0;const t=e.match(U);if(!t)return 0;const n=t[1]==="+"?-1:1,s=parseInt(t[2]),r=t[3]&&parseInt(t[3])||0;return z(s,r)?n*(s*T+r*h):NaN}function A(e,t,n){const s=new Date(0);s.setUTCFullYear(e,0,4);const r=s.getUTCDay()||7,o=(t-1)*7+n+1-r;return s.setUTCDate(s.getUTCDate()+o),s}const M=[31,null,31,30,31,30,31,31,30,31,30,31];function D(e){return e%400===0||e%4===0&&e%100!==0}function Y(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(M[t]||(D(e)?29:28))}function $(e,t){return t>=1&&t<=(D(e)?366:365)}function O(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function W(e,t,n){return e===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}function z(e,t){return t>=0&&t<=59}const G=(e,t="$")=>{const n=Math.abs(e);let s;return n>=1e6?s=`${(n/1e6).toFixed(1)}M`:n>=1e3?s=`${(n/1e3).toFixed(1)}K`:s=n.toFixed(0),`${e>=0?"+":"-"}${t}${s}`},q=(e,t)=>{const n=e+t;return n===0?0:Math.round(e/n*100)},L=e=>{if(!e||e.length===0)return{totalPL:0,tradeCount:0,winCount:0,lossCount:0,winRate:0,avgWin:0,avgLoss:0};const t=e.reduce((a,c)=>a+c.amount,0),n=e.filter(a=>a.amount>0),s=e.filter(a=>a.amount<0),r=n.length>0?n.reduce((a,c)=>a+c.amount,0)/n.length:0,o=s.length>0?s.reduce((a,c)=>a+Math.abs(c.amount),0)/s.length:0;return{totalPL:t,tradeCount:e.length,winCount:n.length,lossCount:s.length,winRate:q(n.length,s.length),avgWin:r,avgLoss:o}},P=(e,t)=>Array.from({length:12},(s,r)=>r).map(s=>{const r=e.filter(o=>{const a=N(o.date);return a.getFullYear()===t&&a.getMonth()===s});return{month:s,...L(r)}}),Q=()=>crypto.randomUUID(),b=e=>!e||e.length<5?null:{tagId:e[0],name:e[1],color:e[2],emoji:e[3],order:parseInt(e[4])||0},Z=async()=>{const e="1ruzm5D-ofifAU7d5oRChBT7DAYFTlVLgULSsXvYEtXU";console.log("ðŸ·ï¸ Fetching tags from sheet:",e);try{const n=(await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:e,range:`${f.TAGS}!A2:E`})).result.values||[];console.log("ðŸ“¥ Received tag rows:",n.length);const s=n.map(b).filter(Boolean);return console.log("âœ… Parsed tags:",s),s.sort((r,o)=>r.order-o.order)}catch(t){return console.error("âŒ Failed to fetch tags:",t),[]}},_=async e=>{const t=await I.getOrCreateSpreadsheet(),n=[e.tagId,e.name,e.color,e.emoji,e.order||0];return await window.gapi.client.sheets.spreadsheets.values.append({spreadsheetId:t,range:`${f.TAGS}!A:E`,valueInputOption:"USER_ENTERED",resource:{values:[n]}}),e},k=async e=>{const t=localStorage.getItem(y.SHEET_ID),r=((await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:t,range:`${f.TAGS}!A:A`})).result.values||[]).findIndex(o=>o[0]===e);if(r===-1)throw new Error("Tag not found");await window.gapi.client.sheets.spreadsheets.batchUpdate({spreadsheetId:t,resource:{requests:[{deleteDimension:{range:{sheetId:1,dimension:"ROWS",startIndex:r,endIndex:r+1}}}]}})},j=()=>w({queryKey:["tags"],queryFn:Z,staleTime:0,gcTime:0,refetchOnMount:"always"}),B=()=>{const e=p();return m({mutationFn:_,onSuccess:()=>{e.invalidateQueries({queryKey:["tags"]})}})},X=()=>{const e=p();return m({mutationFn:k,onSuccess:()=>{e.invalidateQueries({queryKey:["tags"]})}})};export{B as a,X as b,P as c,G as f,Q as g,j as u};
