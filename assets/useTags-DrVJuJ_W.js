import{i as w,k as h,l as m,m as I,S as g}from"./index-BphPB1Ha.js";const p=6e4,T=36e5;function y(e,t){const s=U(e);let r;if(s.date){const i=v(s.date,2);r=A(i.restDateString,i.year)}if(!r||isNaN(r.getTime()))return new Date(NaN);const o=r.getTime();let a=0,c;if(s.time&&(a=x(s.time),isNaN(a)))return new Date(NaN);if(s.timezone){if(c=M(s.timezone),isNaN(c))return new Date(NaN)}else{const i=new Date(o+a),u=new Date(0);return u.setFullYear(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()),u.setHours(i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds()),u}return new Date(o+a+c)}const d={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},N=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,S=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,C=/^([+-])(\d{2})(?::?(\d{2}))?$/;function U(e){const t={},n=e.split(d.dateTimeDelimiter);let s;if(n.length>2)return t;if(/:/.test(n[0])?s=n[0]:(t.date=n[0],s=n[1],d.timeZoneDelimiter.test(t.date)&&(t.date=e.split(d.timeZoneDelimiter)[0],s=e.substr(t.date.length,e.length))),s){const r=d.timezone.exec(s);r?(t.time=s.replace(r[1],""),t.timezone=r[1]):t.time=s}return t}function v(e,t){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=e.match(n);if(!s)return{year:NaN,restDateString:""};const r=s[1]?parseInt(s[1]):null,o=s[2]?parseInt(s[2]):null;return{year:o===null?r:o*100,restDateString:e.slice((s[1]||s[2]).length)}}function A(e,t){if(t===null)return new Date(NaN);const n=e.match(N);if(!n)return new Date(NaN);const s=!!n[4],r=l(n[1]),o=l(n[2])-1,a=l(n[3]),c=l(n[4]),i=l(n[5])-1;if(s)return E(t,c,i)?R(t,c,i):new Date(NaN);{const u=new Date(0);return!$(t,o,a)||!F(t,r)?new Date(NaN):(u.setUTCFullYear(t,o,Math.max(r,a)),u)}}function l(e){return e?parseInt(e):1}function x(e){const t=e.match(S);if(!t)return NaN;const n=f(t[1]),s=f(t[2]),r=f(t[3]);return L(n,s,r)?n*T+s*p+r*1e3:NaN}function f(e){return e&&parseFloat(e.replace(",","."))||0}function M(e){if(e==="Z")return 0;const t=e.match(C);if(!t)return 0;const n=t[1]==="+"?-1:1,s=parseInt(t[2]),r=t[3]&&parseInt(t[3])||0;return O(s,r)?n*(s*T+r*p):NaN}function R(e,t,n){const s=new Date(0);s.setUTCFullYear(e,0,4);const r=s.getUTCDay()||7,o=(t-1)*7+n+1-r;return s.setUTCDate(s.getUTCDate()+o),s}const Y=[31,null,31,30,31,30,31,31,30,31,30,31];function D(e){return e%400===0||e%4===0&&e%100!==0}function $(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(Y[t]||(D(e)?29:28))}function F(e,t){return t>=1&&t<=(D(e)?366:365)}function E(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function L(e,t,n){return e===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}function O(e,t){return t>=0&&t<=59}const G=(e,t="$",n=!1)=>n?"****":`${t}${Math.abs(e).toLocaleString()}`,H=(e,t="$",n=!1)=>n?"****":`${e>=0?"+":"-"}${t}${Math.abs(e).toLocaleString()}`,W=(e,t)=>{const n=e+t;return n===0?0:Math.round(e/n*100)},z=e=>{if(!e||e.length===0)return{totalPL:0,tradeCount:0,winCount:0,lossCount:0,winRate:0,avgWin:0,avgLoss:0};const t=e.reduce((a,c)=>a+c.amount,0),n=e.filter(a=>a.amount>0),s=e.filter(a=>a.amount<0),r=n.length>0?n.reduce((a,c)=>a+c.amount,0)/n.length:0,o=s.length>0?s.reduce((a,c)=>a+Math.abs(c.amount),0)/s.length:0;return{totalPL:t,tradeCount:e.length,winCount:n.length,lossCount:s.length,winRate:W(n.length,s.length),avgWin:r,avgLoss:o}},Q=(e,t)=>Array.from({length:12},(s,r)=>r).map(s=>{const r=e.filter(o=>{const a=y(o.date);return a.getFullYear()===t&&a.getMonth()===s});return{month:s,...z(r)}}),X=()=>crypto.randomUUID(),q=e=>!e||e.length<5?null:{tagId:e[0],name:e[1],color:e[2],emoji:e[3],order:parseInt(e[4])||0},b=async()=>{const e="1ruzm5D-ofifAU7d5oRChBT7DAYFTlVLgULSsXvYEtXU";console.log("ðŸ·ï¸ Fetching tags from sheet:",e);try{const n=(await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:e,range:`${g.TAGS}!A2:E`})).result.values||[];console.log("ðŸ“¥ Received tag rows:",n.length);const s=n.map(q).filter(Boolean);return console.log("âœ… Parsed tags:",s),s.sort((r,o)=>r.order-o.order)}catch(t){return console.error("âŒ Failed to fetch tags:",t),[]}},k=async e=>{const t=await I.getOrCreateSpreadsheet(),n=[e.tagId,e.name,e.color,e.emoji,e.order||0];return await window.gapi.client.sheets.spreadsheets.values.append({spreadsheetId:t,range:`${g.TAGS}!A:E`,valueInputOption:"USER_ENTERED",resource:{values:[n]}}),e},P=async e=>{const t="1ruzm5D-ofifAU7d5oRChBT7DAYFTlVLgULSsXvYEtXU";console.log("ðŸ—‘ï¸ Deleting tag:",e);const r=((await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:t,range:`${g.TAGS}!A:A`})).result.values||[]).findIndex(i=>i[0]===e);if(r===-1)throw new Error("Tag not found");console.log("ðŸ“ Found tag at row index:",r);const c=(await window.gapi.client.sheets.spreadsheets.get({spreadsheetId:t})).result.sheets.find(i=>i.properties.title===g.TAGS).properties.sheetId;console.log("ðŸ“‹ Tags sheet ID:",c),await window.gapi.client.sheets.spreadsheets.batchUpdate({spreadsheetId:t,resource:{requests:[{deleteDimension:{range:{sheetId:c,dimension:"ROWS",startIndex:r,endIndex:r+1}}}]}}),console.log("âœ… Tag deleted successfully")},_=()=>w({queryKey:["tags"],queryFn:b,staleTime:0,gcTime:0,refetchOnMount:"always"}),B=()=>{const e=h();return m({mutationFn:k,onSuccess:()=>{e.invalidateQueries({queryKey:["tags"]})}})},K=()=>{const e=h();return m({mutationFn:P,onSuccess:()=>{e.invalidateQueries({queryKey:["tags"]})}})};export{H as a,B as b,Q as c,K as d,G as f,X as g,_ as u};
