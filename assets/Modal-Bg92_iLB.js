import{c as u,h,e as x,S as d,i as p,r as v,j as n,X as f}from"./index-CzwTjM7E.js";import{u as I,k as g}from"./utils-C6W6dtYo.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=u("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=u("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=u("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),i=e=>!e||e.length<5?null:{tagId:e[0],name:e[1],color:e[2],emoji:e[3],order:parseInt(e[4])||0},T=async()=>{const e=localStorage.getItem(p.SHEET_ID);if(!e)return[];try{return((await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:e,range:`${d.TAGS}!A2:E`})).result.values||[]).map(i).filter(Boolean).sort((r,a)=>r.order-a.order)}catch(s){return console.error("Failed to fetch tags:",s),[]}},E=async e=>{const s=await x.getOrCreateSpreadsheet(),t=[e.tagId,e.name,e.color,e.emoji,e.order||0];return await window.gapi.client.sheets.spreadsheets.values.append({spreadsheetId:s,range:`${d.TAGS}!A:E`,valueInputOption:"USER_ENTERED",resource:{values:[t]}}),e},S=async({tagId:e,updates:s})=>{const t=localStorage.getItem(p.SHEET_ID),a=((await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:t,range:`${d.TAGS}!A:A`})).result.values||[]).findIndex(w=>w[0]===e);if(a===-1)throw new Error("Tag not found");const l=(await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:t,range:`${d.TAGS}!A${a+1}:E${a+1}`})).result.values[0],o=i(l),y=[e,s.name||o.name,s.color||o.color,s.emoji||o.emoji,s.order!==void 0?s.order:o.order];return await window.gapi.client.sheets.spreadsheets.values.update({spreadsheetId:t,range:`${d.TAGS}!A${a+1}:E${a+1}`,valueInputOption:"USER_ENTERED",resource:{values:[y]}}),i(y)},k=async e=>{const s=localStorage.getItem(p.SHEET_ID),r=((await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:s,range:`${d.TAGS}!A:A`})).result.values||[]).findIndex(a=>a[0]===e);if(r===-1)throw new Error("Tag not found");await window.gapi.client.sheets.spreadsheets.batchUpdate({spreadsheetId:s,resource:{requests:[{deleteDimension:{range:{sheetId:1,dimension:"ROWS",startIndex:r,endIndex:r+1}}}]}})},M=()=>I({queryKey:["tags"],queryFn:T,staleTime:10*60*1e3,cacheTime:60*60*1e3}),R=()=>{const e=h();return g({mutationFn:E,onSuccess:()=>{e.invalidateQueries({queryKey:["tags"]})}})},N=()=>{const e=h();return g({mutationFn:S,onSuccess:()=>{e.invalidateQueries({queryKey:["tags"]})}})},G=()=>{const e=h();return g({mutationFn:k,onSuccess:()=>{e.invalidateQueries({queryKey:["tags"]})}})},C=({isOpen:e,onClose:s,title:t,children:c,showCloseButton:r=!0,size:a="md"})=>{if(v.useEffect(()=>(e?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[e]),!e)return null;const m=o=>{o.target===o.currentTarget&&s()},l={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",full:"max-w-6xl"};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"modal-backdrop animate-fade-in",onClick:m}),n.jsxs("div",{className:`modal-content ${l[a]} w-full`,children:[(t||r)&&n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[t&&n.jsx("h2",{className:"text-xl font-semibold text-text-primary",children:t}),r&&n.jsx("button",{onClick:s,className:"p-2 hover:bg-surface-hover rounded-lg transition-colors",children:n.jsx(f,{size:20,className:"text-text-secondary"})})]}),n.jsx("div",{className:"p-6",children:c})]})]})};export{C as M,b as P,q as S,$ as T,G as a,R as b,N as c,M as u};
